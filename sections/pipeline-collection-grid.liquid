{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-facets.css' | asset_url | stylesheet_tag }}

{%- unless section.settings.quick_add == 'none' -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
{%- endunless -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* PIPELINE TARGET LAYOUT CSS */
  .pipeline-collection-layout {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 8px;
    max-width: 1200px;
    margin: 0 auto;
    padding: 5px;
    align-items: start;
  }

  @media screen and (max-width: 989px) {
    .pipeline-collection-layout {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }

  .pipeline-filters-sidebar {
    background: white;
    padding: 0;
    position: sticky;
    top: 2rem;
  }

  @media screen and (max-width: 989px) {
    .pipeline-filters-sidebar {
      position: relative;
      top: 0;
    }
  }

  /* Toolbar exactly like target */
  .pipeline-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #e0e0e0;
    margin-bottom: 15px;
  }

  .toolbar-left {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .hide-filters-btn {
    background: white;
    border: 1px solid #ccc;
    padding: 8px 16px;
    font-size: 12px;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 500;
  }

  .product-count-display {
    font-size: 14px;
    color: #666;
  }

  .toolbar-right {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .pipeline-sort-select {
    border: 1px solid #ccc;
    padding: 8px 12px;
    font-size: 14px;
    background: white;
    cursor: pointer;
  }

  .grid-view-toggle {
    display: flex;
    border: 1px solid #ccc;
    overflow: hidden;
  }

  .grid-view-toggle button {
    background: white;
    border: none;
    padding: 8px 10px;
    cursor: pointer;
    font-size: 12px;
  }

  .grid-view-toggle button.active {
    background: #333;
    color: white;
  }

  /* Category navigation exactly like target */
  .pipeline-categories ul {
    list-style: none;
    padding: 0;
    margin: 0 0 25px 0;
  }

  .pipeline-categories li {
    margin-bottom: 4px;
  }

  .pipeline-categories a {
    color: #666;
    text-decoration: none;
    font-size: 11px;
    font-weight: normal;
    display: block;
    padding: 1px 0;
  }

  .pipeline-categories a.active,
  .pipeline-categories a:hover {
    color: #000;
    font-weight: 600;
  }

  /* Products grid exactly like target */
  .pipeline-products-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  /* Product cards exactly like target */
  .pipeline-product-card {
    background: white;
    border: 1px solid #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    transition: box-shadow 0.2s ease;
  }

  .pipeline-product-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .pipeline-card-media {
    position: relative;
    background: white;
    height: 520px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0px;
  }

  .pipeline-product-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  .pipeline-card-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: #e74c3c;
    color: white;
    padding: 3px 6px;
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 2px;
    z-index: 10;
  }

  .pipeline-card-badge.sold-out {
    background: #666;
  }

  .pipeline-card-content {
    padding: 2px 4px 6px 4px;
    text-align: center;
  }

  .pipeline-card-title {
    font-size: 11px;
    font-weight: normal;
    color: #333;
    margin-bottom: 4px;
    line-height: 1.1;
  }

  .pipeline-card-title a {
    color: inherit;
    text-decoration: none;
  }

  .pipeline-card-price {
    margin-top: 4px;
  }

  .pipeline-original-price {
    color: #999;
    text-decoration: line-through;
    font-size: 13px;
    display: block;
    margin-bottom: 4px;
  }

  .pipeline-sale-price {
    color: #e74c3c;
    font-size: 14px;
    font-weight: 600;
  }

  .pipeline-regular-price {
    color: #333;
    font-size: 14px;
    font-weight: 600;
  }
{%- endstyle -%}

<div class="section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}">
  {%- paginate collection.products by section.settings.products_per_page -%}
    <div class="pipeline-collection-layout">
      
      {%- if section.settings.show_filters -%}
        <!-- Sidebar Filters -->
        <div class="pipeline-filters-sidebar">
          
          <!-- Category Navigation -->
          <div class="pipeline-categories">
            <ul>
              <li><a href="/collections" class="{% if collection.handle == blank %}active{% endif %}">ALL COLLECTIONS</a></li>
              <li><a href="/collections/accessories">ACCESSORI BICI</a></li>
              <li><a href="/collections/bicycles">BICYCLES</a></li>
              <li><a href="/collections/caschi">CASCHI</a></li>
              <li><a href="/collections/cestini">CESTINI</a></li>
              <li><a href="/collections/e-bike-cargo">E-BIKE CARGO</a></li>
              <li><a href="/collections/e-bikes" class="{% if collection.handle == 'e-bikes' %}active{% endif %}">E-BIKES</a></li>
              <li><a href="/collections/luci">LUCI</a></li>
              <li><a href="/collections/parafanghi">PARAFANGHI</a></li>
              <li><a href="/collections/portapacchi">PORTAPACCHI</a></li>
            </ul>
          </div>

          <!-- Availability Filter -->
          <div class="pipeline-availability-filter">
            <h3 style="font-size: 13px; font-weight: 600; text-transform: uppercase; color: #333; margin-bottom: 10px;">AVAILABILITY</h3>
            <div>
              <label style="display: flex; align-items: center; margin-bottom: 6px; font-size: 13px; color: #666;">
                <input type="checkbox" style="margin-right: 8px; width: 16px; height: 16px; accent-color: #000;">
                In stock ({{ collection.products_count }})
              </label>
              <label style="display: flex; align-items: center; margin-bottom: 6px; font-size: 13px; color: #666;">
                <input type="checkbox" style="margin-right: 8px; width: 16px; height: 16px; accent-color: #000;">
                Out of stock (0)
              </label>
            </div>
          </div>

          <!-- Price Filter -->
          <div class="pipeline-price-filter" style="margin-top: 25px;">
            <h3 style="font-size: 13px; font-weight: 600; text-transform: uppercase; color: #333; margin-bottom: 10px;">PRICE</h3>
            <div style="width: 100%; height: 4px; background: #ddd; border-radius: 2px; position: relative; margin: 10px 0;">
              <div style="width: 14px; height: 14px; background: #333; border-radius: 50%; position: absolute; top: -5px; left: 20%; cursor: pointer;"></div>
              <div style="width: 14px; height: 14px; background: #333; border-radius: 50%; position: absolute; top: -5px; left: 80%; cursor: pointer;"></div>
            </div>
          </div>
          
        </div>
      {%- endif -%}

      <!-- Product Grid -->
      <div class="pipeline-product-container">
        
        <!-- Toolbar -->
        <div class="pipeline-toolbar">
          <div class="toolbar-left">
            <button class="hide-filters-btn">◀ HIDE FILTERS</button>
            <div class="product-count-display">{{ collection.products_count }} products</div>
          </div>
          <div class="toolbar-right">
            <select class="pipeline-sort-select">
              {%- for option in collection.sort_options -%}
                <option value="{{ option.value | escape }}">{{ option.name | escape }}</option>
              {%- endfor -%}
            </select>
            <div class="grid-view-toggle">
              <button class="active">⊞⊞⊞</button>
              <button>⊞⊞⊞⊞</button>
            </div>
          </div>
        </div>

        <!-- Products -->
        <ul class="pipeline-products-grid">
          {%- for product in collection.products -%}
            <li class="pipeline-product-card">
              
              <!-- Product Image -->
              <div class="pipeline-card-media">
                {%- if product.available == false -%}
                  <div class="pipeline-card-badge sold-out">SOLD OUT</div>
                {%- elsif product.compare_at_price > product.price -%}
                  <div class="pipeline-card-badge">SALE</div>
                {%- endif -%}
                
                <img 
                  class="pipeline-product-image"
                  src="{{ product.featured_media | img_url: '600x600' }}" 
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                >
              </div>

              <!-- Product Info -->
              <div class="pipeline-card-content">
                <div class="pipeline-card-title">
                  <a href="{{ product.url }}">{{ product.title | escape }}</a>
                </div>
                
                <div class="pipeline-card-price">
                  {%- if product.compare_at_price > product.price -%}
                    <div class="pipeline-original-price">{{ product.compare_at_price | money }}</div>
                    <div class="pipeline-sale-price">{{ product.price | money }}</div>
                  {%- else -%}
                    <div class="pipeline-regular-price">{{ product.price | money }}</div>
                  {%- endif -%}
                </div>
              </div>
              
            </li>
          {%- endfor -%}
        </ul>

        {%- if paginate.pages > 1 -%}
          {% render 'pagination', paginate: paginate, anchor: '' %}
        {%- endif -%}
        
      </div>
    </div>
  {%- endpaginate -%}
</div>

<script src="{{ 'facets.js' | asset_url }}" defer="defer"></script>

{%- if section.settings.quick_add == 'standard' -%}
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{% schema %}
{
  "name": "Pipeline Collection Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 16,
      "label": "Products per page"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 3,
      "label": "Number of columns on desktop"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "Number of columns on mobile",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ]
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "adapt",
      "label": "Image ratio"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Show second image on hover"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "Show product rating"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "default": true,
      "label": "Enable filtering"
    },
    {
      "type": "select",
      "id": "quick_add",
      "default": "none",
      "label": "Quick add",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "standard",
          "label": "Standard"
        },
        {
          "value": "bulk",
          "label": "Bulk"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ]
}
{% endschema %}