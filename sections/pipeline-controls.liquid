{% comment %}
  Pipeline Controls Section
  Allows admin to control all Pipeline features from the dashboard
{% endcomment %}

<div class="pipeline-controls-section">
  <div class="page-width">
    
    {% if section.settings.show_heading %}
      <div class="section-header">
        <h2>{{ section.settings.heading }}</h2>
        {% if section.settings.description %}
          <p>{{ section.settings.description }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="controls-grid">
      
      <!-- Search Controls -->
      <div class="control-group">
        <h3>üîç Enhanced Search</h3>
        <div class="control-options">
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.enable_enhanced_search %}checked{% endif %} 
                   onchange="togglePipelineFeature('search', this.checked)">
            <span>Enable Pipeline Search Styling</span>
          </label>
          
          {% if section.settings.enable_enhanced_search %}
            <div class="sub-controls">
              <label>
                Search Placeholder:
                <input type="text" value="{{ section.settings.search_placeholder | default: 'Search products...' }}" 
                       onchange="updateSearchPlaceholder(this.value)">
              </label>
              
              <label class="control-toggle">
                <input type="checkbox" {% if section.settings.search_blur_background %}checked{% endif %}>
                <span>Blur Background</span>
              </label>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Image Zoom Controls -->
      <div class="control-group">
        <h3>üîç Product Image Zoom</h3>
        <div class="control-options">
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.enable_image_zoom %}checked{% endif %}
                   onchange="togglePipelineFeature('zoom', this.checked)">
            <span>Enable Image Zoom</span>
          </label>
          
          {% if section.settings.enable_image_zoom %}
            <div class="sub-controls">
              <label>
                Zoom Level:
                <input type="range" min="1.5" max="3" step="0.1" 
                       value="{{ section.settings.zoom_level | default: 2 }}"
                       onchange="updateZoomLevel(this.value)">
                <span class="range-value">{{ section.settings.zoom_level | default: 2 }}x</span>
              </label>
              
              <label class="control-toggle">
                <input type="checkbox" {% if section.settings.zoom_on_mobile %}checked{% endif %}>
                <span>Enable on Mobile</span>
              </label>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Cart Drawer Controls -->  
      <div class="control-group">
        <h3>üõí Enhanced Cart Drawer</h3>
        <div class="control-options">
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.enable_enhanced_cart %}checked{% endif %}
                   onchange="togglePipelineFeature('cart', this.checked)">
            <span>Enable Pipeline Cart Styling</span>
          </label>
          
          {% if section.settings.enable_enhanced_cart %}
            <div class="sub-controls">
              <label class="control-toggle">
                <input type="checkbox" {% if section.settings.cart_show_count %}checked{% endif %}>
                <span>Show Item Count Badge</span>
              </label>
              
              <label class="control-toggle">
                <input type="checkbox" {% if section.settings.cart_blur_background %}checked{% endif %}>
                <span>Blur Background</span>
              </label>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Animation Controls -->
      <div class="control-group">
        <h3>‚ú® Pipeline Animations</h3>
        <div class="control-options">
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.enable_animations %}checked{% endif %}
                   onchange="togglePipelineFeature('animations', this.checked)">
            <span>Enable Pipeline Animations</span>
          </label>
          
          {% if section.settings.enable_animations %}
            <div class="sub-controls">
              <label>
                Animation Speed:
                <select onchange="updateAnimationSpeed(this.value)">
                  <option value="slow" {% if section.settings.animation_speed == 'slow' %}selected{% endif %}>Slow</option>
                  <option value="normal" {% if section.settings.animation_speed == 'normal' or section.settings.animation_speed == blank %}selected{% endif %}>Normal</option>
                  <option value="fast" {% if section.settings.animation_speed == 'fast' %}selected{% endif %}>Fast</option>
                </select>
              </label>
              
              <label class="control-toggle">
                <input type="checkbox" {% if section.settings.scroll_animations %}checked{% endif %}>
                <span>Scroll Animations</span>
              </label>
              
              <label class="control-toggle">
                <input type="checkbox" {% if section.settings.hover_animations %}checked{% endif %}>
                <span>Hover Animations</span>
              </label>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Performance Controls -->
      <div class="control-group">
        <h3>‚ö° Performance</h3>
        <div class="control-options">
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.enable_lazy_loading %}checked{% endif %}>
            <span>Lazy Load Images</span>
          </label>
          
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.enable_prefetching %}checked{% endif %}>
            <span>Prefetch Resources</span>
          </label>
          
          <label class="control-toggle">
            <input type="checkbox" {% if section.settings.optimize_low_end %}checked{% endif %}>
            <span>Optimize for Low-End Devices</span>
          </label>
        </div>
      </div>

    </div>

    <!-- Live Preview -->
    {% if section.settings.show_preview %}
      <div class="pipeline-preview">
        <h3>Live Preview</h3>
        <div class="preview-grid">
          
          <div class="preview-item">
            <h4>Search Modal</h4>
            <button onclick="document.querySelector('.header__search summary').click()">
              Test Search
            </button>
          </div>
          
          <div class="preview-item">
            <h4>Image Zoom</h4>
            <div class="preview-image">
              <img src="{{ 'product-1.jpg' | asset_url }}" alt="Preview" class="pipeline-zoomable">
            </div>
          </div>
          
          <div class="preview-item">
            <h4>Cart Drawer</h4>
            <button onclick="document.querySelector('[data-cart-drawer]').click()">
              Open Cart
            </button>
          </div>
          
        </div>
      </div>
    {% endif %}

  </div>
</div>

<script>
function togglePipelineFeature(feature, enabled) {
  document.documentElement.setAttribute(`data-pipeline-${feature}`, enabled);
  
  // Apply changes immediately
  switch(feature) {
    case 'search':
      document.body.classList.toggle('pipeline-search-enabled', enabled);
      break;
    case 'zoom':
      document.body.classList.toggle('pipeline-zoom-enabled', enabled);
      break;
    case 'cart':
      document.body.classList.toggle('pipeline-cart-enabled', enabled);
      break;
    case 'animations':
      document.body.classList.toggle('pipeline-animations-enabled', enabled);
      break;
  }
  
  console.log(`Pipeline ${feature} ${enabled ? 'enabled' : 'disabled'}`);
}

function updateZoomLevel(level) {
  document.documentElement.style.setProperty('--pipeline-zoom-level', level);
  document.querySelector('.range-value').textContent = level + 'x';
}

function updateAnimationSpeed(speed) {
  const speeds = {
    slow: { normal: '0.6s', fast: '0.3s' },
    normal: { normal: '0.3s', fast: '0.15s' },
    fast: { normal: '0.15s', fast: '0.1s' }
  };
  
  document.documentElement.style.setProperty('--pipeline-transition-normal', speeds[speed].normal + ' cubic-bezier(0.4, 0, 0.2, 1)');
  document.documentElement.style.setProperty('--pipeline-transition-fast', speeds[speed].fast + ' cubic-bezier(0.4, 0, 0.2, 1)');
}

function updateSearchPlaceholder(placeholder) {
  const searchInputs = document.querySelectorAll('.pipeline-search-field input');
  searchInputs.forEach(input => {
    input.placeholder = placeholder;
  });
}

// Initialize settings from section data
document.addEventListener('DOMContentLoaded', function() {
  // Set initial states
  {% if section.settings.enable_enhanced_search %}
    document.body.classList.add('pipeline-search-enabled');
  {% endif %}
  
  {% if section.settings.enable_image_zoom %}
    document.body.classList.add('pipeline-zoom-enabled');
  {% endif %}
  
  {% if section.settings.enable_enhanced_cart %}
    document.body.classList.add('pipeline-cart-enabled');
  {% endif %}
  
  {% if section.settings.enable_animations %}
    document.body.classList.add('pipeline-animations-enabled');
  {% endif %}
  
  // Set zoom level
  {% if section.settings.zoom_level %}
    updateZoomLevel({{ section.settings.zoom_level }});
  {% endif %}
  
  // Set animation speed
  {% if section.settings.animation_speed %}
    updateAnimationSpeed('{{ section.settings.animation_speed }}');
  {% endif %}
});
</script>

<style>
.pipeline-controls-section {
  padding: 4rem 0;
  background: #f8f9fa;
}

.section-header {
  text-align: center;
  margin-bottom: 3rem;
}

.section-header h2 {
  font-size: 2.5rem;
  color: #2c2c2c;
  margin-bottom: 1rem;
}

.controls-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-bottom: 3rem;
}

.control-group {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.control-group h3 {
  font-size: 1.25rem;
  margin-bottom: 1.5rem;
  color: #2c2c2c;
}

.control-options {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.control-toggle {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-weight: 500;
  cursor: pointer;
}

.control-toggle input[type="checkbox"] {
  width: 20px;
  height: 20px;
  accent-color: #2c2c2c;
}

.sub-controls {
  margin-left: 2rem;
  padding-left: 1rem;
  border-left: 2px solid #e9ecef;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.sub-controls label {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.sub-controls input,
.sub-controls select {
  padding: 8px 12px;
  border: 1px solid #e1e5e9;
  border-radius: 8px;
  font-size: 0.875rem;
}

.range-value {
  font-weight: bold;
  color: #2c2c2c;
}

.pipeline-preview {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.pipeline-preview h3 {
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
  color: #2c2c2c;
  text-align: center;
}

.preview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
}

.preview-item {
  text-align: center;
  padding: 1.5rem;
  border: 2px solid #e9ecef;
  border-radius: 12px;
}

.preview-item h4 {
  margin-bottom: 1rem;
  color: #2c2c2c;
}

.preview-item button {
  background: #2c2c2c;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s ease;
}

.preview-item button:hover {
  background: #1a1a1a;
  transform: translateY(-2px);
}

.preview-image {
  width: 80px;
  height: 80px;
  margin: 0 auto 1rem;
  border-radius: 8px;
  overflow: hidden;
}

.preview-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

@media (max-width: 768px) {
  .controls-grid {
    grid-template-columns: 1fr;
  }
  
  .preview-grid {
    grid-template-columns: 1fr;
  }
}
</style>

{% schema %}
{
  "name": "Pipeline Controls",
  "tag": "section", 
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "checkbox",
      "id": "show_heading",
      "default": true,
      "label": "Show section heading"
    },
    {
      "type": "text",
      "id": "heading",
      "default": "Pipeline Feature Controls",
      "label": "Section heading"
    },
    {
      "type": "textarea",
      "id": "description",
      "default": "Control all your Pipeline theme features from one place.",
      "label": "Description"
    },
    {
      "type": "header",
      "content": "Search Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_enhanced_search",
      "default": true,
      "label": "Enable Pipeline search styling"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "default": "Search products...",
      "label": "Search placeholder text"
    },
    {
      "type": "checkbox",
      "id": "search_blur_background",
      "default": true,
      "label": "Blur search background"
    },
    {
      "type": "header",
      "content": "Image Zoom Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_image_zoom",
      "default": true,
      "label": "Enable product image zoom"
    },
    {
      "type": "range",
      "id": "zoom_level",
      "min": 1.5,
      "max": 3,
      "step": 0.1,
      "default": 2,
      "label": "Zoom level"
    },
    {
      "type": "checkbox",
      "id": "zoom_on_mobile",
      "default": true,
      "label": "Enable zoom on mobile"
    },
    {
      "type": "header",
      "content": "Cart Drawer Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_enhanced_cart",
      "default": true,
      "label": "Enable Pipeline cart styling"
    },
    {
      "type": "checkbox",
      "id": "cart_show_count",
      "default": true,
      "label": "Show item count badge"
    },
    {
      "type": "checkbox",
      "id": "cart_blur_background",
      "default": true,
      "label": "Blur cart background"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_animations",
      "default": true,
      "label": "Enable Pipeline animations"
    },
    {
      "type": "select",
      "id": "animation_speed",
      "options": [
        { "value": "slow", "label": "Slow" },
        { "value": "normal", "label": "Normal" },
        { "value": "fast", "label": "Fast" }
      ],
      "default": "normal",
      "label": "Animation speed"
    },
    {
      "type": "checkbox",
      "id": "scroll_animations",
      "default": true,
      "label": "Scroll animations"
    },
    {
      "type": "checkbox",
      "id": "hover_animations",
      "default": true,
      "label": "Hover animations"
    },
    {
      "type": "header",
      "content": "Performance Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_lazy_loading",
      "default": true,
      "label": "Enable lazy loading"
    },
    {
      "type": "checkbox",
      "id": "enable_prefetching",
      "default": true,
      "label": "Enable resource prefetching"
    },
    {
      "type": "checkbox",
      "id": "optimize_low_end",
      "default": false,
      "label": "Optimize for low-end devices"
    },
    {
      "type": "header",
      "content": "Preview"
    },
    {
      "type": "checkbox",
      "id": "show_preview",
      "default": true,
      "label": "Show live preview section"
    }
  ],
  "presets": [
    {
      "name": "Pipeline Controls"
    }
  ]
}
{% endschema %}