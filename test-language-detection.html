<!DOCTYPE html>
<html lang="it">  <!-- Site set to Italian to test mismatch scenario -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Detection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }
        .test-button {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
        }
        .detected-lang {
            background: #d4edda;
            color: #155724;
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
            margin: 5px 0;
            font-weight: bold;
        }
        .test-examples {
            background: #e7f3ff;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .example-text {
            background: white;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 4px solid #3B82F6;
            cursor: pointer;
        }
        .example-text:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🌍 Language Detection Test</h1>
        <p><strong>Site Language:</strong> <span id="site-language"></span></p>
        <p><strong>Test Scenario:</strong> Italian site language + multilingual chat detection</p>
        
        <div class="test-examples">
            <h3>📝 Test Examples (click to try):</h3>
            
            <div class="example-text" onclick="testMessage(this.textContent)">
                🇩🇪 Ich suche ein E-Bike für den Arbeitsweg in Zürich
            </div>
            <div class="example-text" onclick="testMessage(this.textContent)">
                🇮🇹 Cerco una e-bike per andare al lavoro a Lugano
            </div>
            <div class="example-text" onclick="testMessage(this.textContent)">
                🇫🇷 Je cherche un vélo électrique pour Genève
            </div>
            <div class="example-text" onclick="testMessage(this.textContent)">
                🇩🇪 Welches E-Bike ist gut für bergige Strecken?
            </div>
            <div class="example-text" onclick="testMessage(this.textContent)">
                🇮🇹 Quanto costa una mountain bike elettrica?
            </div>
            <div class="example-text" onclick="testMessage(this.textContent)">
                🇫🇷 Combien coûte un vélo électrique de montagne?
            </div>
            <div class="example-text" onclick="testMessage(this.textContent)">
                🔤 Hello, I need an e-bike (ambiguous/english)
            </div>
        </div>

        <div>
            <h3>🧪 Custom Test:</h3>
            <input type="text" 
                   id="test-input" 
                   class="test-input" 
                   placeholder="Type your message in any language..."
                   onkeypress="if(event.key==='Enter') testLanguageDetection()">
            <button class="test-button" onclick="testLanguageDetection()">
                Test Language Detection
            </button>
        </div>

        <div id="results"></div>
    </div>

    <script src="assets/ai-chatbot-integration.js"></script>
    <script>
        // Display current site language
        document.getElementById('site-language').textContent = 
            document.documentElement.lang + ' (Italian)';

        function testMessage(message) {
            document.getElementById('test-input').value = message;
            testLanguageDetection();
        }

        function testLanguageDetection() {
            const message = document.getElementById('test-input').value;
            if (!message.trim()) return;

            // Create instance of our AI chatbot to test language detection
            const chatbot = new AIChainBot();
            
            // Test the language detection
            const detectedLanguage = chatbot.detectMessageLanguage(message);
            const siteLanguage = chatbot.userContext.language;
            
            // Show results
            const resultsDiv = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            
            const resultHTML = `
                <div class="test-result">
                    <strong>🕐 ${timestamp}</strong><br>
                    <strong>📝 Message:</strong> "${message}"<br>
                    <strong>🌐 Site Language:</strong> ${siteLanguage} (${getSiteLanguageName(siteLanguage)})<br>
                    <strong>🔍 Detected Language:</strong> 
                    ${detectedLanguage ? 
                        `<span class="detected-lang">${detectedLanguage} (${getLanguageName(detectedLanguage)})</span>` : 
                        '<span style="color: #856404; background: #fff3cd; padding: 4px 8px; border-radius: 4px;">No language detected - will use site default</span>'
                    }<br>
                    <strong>💬 AI Would Respond In:</strong> ${getResponseLanguage(detectedLanguage, siteLanguage)}
                </div>
            `;
            
            resultsDiv.innerHTML = resultHTML + resultsDiv.innerHTML;
            
            // Clear input
            document.getElementById('test-input').value = '';
        }

        function getLanguageName(code) {
            const names = {
                'de': 'German',
                'it': 'Italian', 
                'fr': 'French',
                'en': 'English'
            };
            return names[code] || code;
        }

        function getSiteLanguageName(code) {
            return getLanguageName(code);
        }

        function getResponseLanguage(detected, site) {
            const responseLanguage = detected || site || 'de';
            return `${responseLanguage} (${getLanguageName(responseLanguage)})`;
        }

        // Test on page load
        window.addEventListener('load', () => {
            // Auto-test with German message on Italian site
            setTimeout(() => {
                testMessage('Ich suche ein E-Bike für Zürich');
            }, 500);
        });
    </script>
</body>
</html>