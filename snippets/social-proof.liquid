{% comment %}
  Social Proof Elements
  Displays customer count, recent purchases, and trust indicators
  
  Usage:
  {% render 'social-proof', type: 'customer-count' %}
  {% render 'social-proof', type: 'recent-purchases' %}
  {% render 'social-proof', type: 'trust-badges' %}
{% endcomment %}

{{ 'social-proof.css' | asset_url | stylesheet_tag }}

{%- unless settings.enable_social_proof == false -%}
{%- case type -%}
  {%- when 'customer-count' -%}
    {%- if settings.show_customer_count -%}
    <div class="social-proof social-proof--customer-count">
      <div class="social-proof__content">
        <div class="social-proof__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="social-proof__text">
          <span class="social-proof__number" data-counter="start">{{ settings.customer_count_number | default: 15000 }}</span>
          <span class="social-proof__label">{{ settings.customer_count_label | default: '+ zufriedene Kunden' }}</span>
        </div>
      </div>
    </div>
    {%- endif -%}

  {%- when 'recent-purchases' -%}
    {%- if settings.show_recent_purchases -%}
    <div class="social-proof social-proof--recent-purchases" data-social-proof="recent" data-frequency="{{ settings.purchase_notification_frequency | default: 20 }}">
      <div class="social-proof__notification animate-slide-up" style="display: none;">
        <div class="social-proof__avatar">
          <div class="social-proof__avatar-placeholder"></div>
        </div>
        <div class="social-proof__message">
          <span class="social-proof__customer-name"></span> aus 
          <span class="social-proof__location"></span> hat gerade
          <span class="social-proof__product-name"></span> gekauft
        </div>
        <div class="social-proof__time">vor <span class="social-proof__time-value"></span> Minuten</div>
      </div>
    </div>
    {%- endif -%}

  {%- when 'trust-badges' -%}
    {%- if settings.show_trust_badges -%}
    <div class="social-proof social-proof--trust-badges">
      <div class="social-proof__badges">
        <div class="trust-badge">
          <div class="trust-badge__icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
          </div>
          <div class="trust-badge__content">
            <div class="trust-badge__title">4.8/5 Sterne</div>
            <div class="trust-badge__subtitle">Kundenbewertungen</div>
          </div>
        </div>

        <div class="trust-badge">
          <div class="trust-badge__icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"></path>
              <path d="M9 12l2 2 4-4"></path>
            </svg>
          </div>
          <div class="trust-badge__content">
            <div class="trust-badge__title">SSL Gesichert</div>
            <div class="trust-badge__subtitle">256-Bit Verschl√ºsselung</div>
          </div>
        </div>

        <div class="trust-badge">
          <div class="trust-badge__icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 5h12l-1 7H5l-2-7Z"></path>
              <path d="M7 17h10l1-7H6l1 7Z"></path>
              <circle cx="9" cy="20" r="1"></circle>
              <circle cx="15" cy="20" r="1"></circle>
            </svg>
          </div>
          <div class="trust-badge__content">
            <div class="trust-badge__title">Schnelle Lieferung</div>
            <div class="trust-badge__subtitle">1-3 Werktage</div>
          </div>
        </div>

        <div class="trust-badge">
          <div class="trust-badge__icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path>
              <path d="M9 12l2 2 4-4"></path>
            </svg>
          </div>
          <div class="trust-badge__content">
            <div class="trust-badge__title">Schweizer Qualit√§t</div>
            <div class="trust-badge__subtitle">Lokaler Service</div>
          </div>
        </div>
      </div>
    </div>

  {%- when 'stock-urgency' -%}
    {%- if settings.show_stock_urgency and product -%}
      {%- assign inventory_quantity = product.selected_or_first_available_variant.inventory_quantity -%}
      {%- assign threshold = settings.stock_urgency_threshold | default: 10 -%}
      {%- if inventory_quantity <= threshold and inventory_quantity > 0 -%}
        <div class="social-proof social-proof--stock-urgency">
          <div class="social-proof__urgency">
            <div class="social-proof__urgency-icon">‚ö°</div>
            <span class="social-proof__urgency-text">
              Nur noch <strong>{{ inventory_quantity }} St√ºck</strong> verf√ºgbar!
            </span>
          </div>
        </div>
      {%- endif -%}
    {%- endif -%}

  {%- when 'sales-popup' -%}
    {%- if settings.show_sales_popup -%}
    <div class="social-proof social-proof--sales-popup" data-social-proof="sales">
      <div class="social-proof__popup animate-fade-in" style="display: none;">
        <div class="social-proof__popup-content">
          <div class="social-proof__popup-icon">üéâ</div>
          <div class="social-proof__popup-text">
            <span class="social-proof__sales-count"></span> E-Bikes heute verkauft!
          </div>
        </div>
      </div>
    </div>
    {%- endif -%}

{%- endcase -%}
{%- endunless -%}

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Customer counter animation
  const counters = document.querySelectorAll('[data-counter="start"]');
  counters.forEach(counter => {
    const target = parseInt(counter.textContent.replace(/\D/g, ''));
    const duration = 2000;
    const increment = target / (duration / 16);
    let current = 0;
    
    const updateCounter = () => {
      if (current < target) {
        current += increment;
        counter.textContent = Math.floor(current).toLocaleString('de-CH') + '+';
        requestAnimationFrame(updateCounter);
      } else {
        counter.textContent = target.toLocaleString('de-CH') + '+';
      }
    };
    
    // Start animation when element is visible
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          updateCounter();
          observer.unobserve(entry.target);
        }
      });
    });
    
    observer.observe(counter);
  });

  // Recent purchases simulation
  const recentPurchases = document.querySelector('[data-social-proof="recent"]');
  if (recentPurchases) {
    const notification = recentPurchases.querySelector('.social-proof__notification');
    
    const customers = [
      'Anna M.', 'Thomas S.', 'Maria L.', 'Peter W.', 'Sarah B.', 'Michael R.',
      'Julia K.', 'David H.', 'Lisa P.', 'Christian M.', 'Nicole T.', 'Stefan G.'
    ];
    
    const cities = [
      'Z√ºrich', 'Basel', 'Bern', 'Genf', 'Lausanne', 'Luzern', 'St. Gallen',
      'Winterthur', 'Thun', 'Chur', 'Aarau', 'Zug'
    ];
    
    const products = [
      'Urban E-Bike Pro', 'Mountain E-Bike Elite', 'City Cruiser', 'Cargo E-Bike',
      'Commuter Special', 'Trail Explorer', 'Urban Speedster', 'Family E-Bike'
    ];
    
    function showRandomPurchase() {
      const customer = customers[Math.floor(Math.random() * customers.length)];
      const city = cities[Math.floor(Math.random() * cities.length)];
      const product = products[Math.floor(Math.random() * products.length)];
      const timeAgo = Math.floor(Math.random() * 30) + 1;
      
      notification.querySelector('.social-proof__customer-name').textContent = customer;
      notification.querySelector('.social-proof__location').textContent = city;
      notification.querySelector('.social-proof__product-name').textContent = product;
      notification.querySelector('.social-proof__time-value').textContent = timeAgo;
      
      notification.style.display = 'flex';
      notification.classList.add('animate-slide-up');
      
      // Hide after 5 seconds
      setTimeout(() => {
        notification.style.display = 'none';
        notification.classList.remove('animate-slide-up');
      }, 5000);
    }
    
    // Show first notification after 3 seconds
    setTimeout(showRandomPurchase, 3000);
    
    // Show subsequent notifications based on admin settings
    const frequency = recentPurchases.dataset.frequency || 20;
    setInterval(() => {
      if (Math.random() > 0.3) { // 70% chance to show
        showRandomPurchase();
      }
    }, frequency * 1000);
  }

  // Sales popup
  const salesPopup = document.querySelector('[data-social-proof="sales"]');
  if (salesPopup) {
    const popup = salesPopup.querySelector('.social-proof__popup');
    const salesCount = Math.floor(Math.random() * 12) + 3; // 3-15 sales
    
    setTimeout(() => {
      popup.querySelector('.social-proof__sales-count').textContent = salesCount;
      popup.style.display = 'flex';
      
      setTimeout(() => {
        popup.style.display = 'none';
      }, 4000);
    }, 8000);
  }
});
</script>