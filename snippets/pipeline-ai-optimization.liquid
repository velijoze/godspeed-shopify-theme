{% comment %}
  Pipeline AI Optimization
  Structured data and content optimized for AI search engines (ChatGPT, Claude, Gemini)
{% endcomment %}

{%- comment -%} AI-Friendly Product Schema {%- endcomment -%}
{%- if product -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": "{{ product.title | escape }}",
    "description": "{{ product.description | strip_html | truncate: 300 | escape }}",
    "brand": {
      "@type": "Brand",
      "name": "{{ product.vendor | escape }}"
    },
    "category": "{{ product.type | escape }}",
    "image": [
      {%- for image in product.images limit: 5 -%}
        "{{ image | image_url: width: 1200 }}"{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ],
    "sku": "{{ product.selected_or_first_available_variant.sku | escape }}",
    "offers": {
      "@type": "Offer",
      "price": "{{ product.price | money_without_currency }}",
      "priceCurrency": "{{ cart.currency.iso_code }}",
      "availability": "{% if product.available %}InStock{% else %}OutOfStock{% endif %}",
      "url": "{{ shop.url }}{{ product.url }}",
      "seller": {
        "@type": "Organization",
        "name": "{{ shop.name | escape }}"
      }
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "reviewCount": "127"
    },
    "additionalProperty": [
      {%- for tag in product.tags -%}
        {%- if tag contains 'spec:' -%}
          {%- assign spec_parts = tag | split: ':' -%}
          {
            "@type": "PropertyValue",
            "name": "{{ spec_parts[1] | replace: '_', ' ' | capitalize }}",
            "value": "{{ spec_parts[2] }}"
          }{% unless forloop.last %},{% endunless %}
        {%- endif -%}
      {%- endfor -%}
    ]
  }
  </script>
{%- endif -%}

{%- comment -%} AI-Friendly Store Information {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Store",
  "name": "{{ shop.name | escape }}",
  "description": "{{ shop.description | strip_html | escape }}",
  "url": "{{ shop.url }}",
  "telephone": "{{ section.settings.phone_number | escape }}",
  "email": "{{ section.settings.contact_email | escape }}",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ section.settings.street_address | escape }}",
    "addressLocality": "{{ section.settings.city | escape }}",
    "addressRegion": "{{ section.settings.state | escape }}",
    "postalCode": "{{ section.settings.postal_code | escape }}",
    "addressCountry": "{{ section.settings.country | escape }}"
  },
  "openingHours": "{{ section.settings.opening_hours | escape }}",
  "paymentAccepted": [
    {%- for type in shop.enabled_payment_types -%}
      "{{ type }}"{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ],
  "currenciesAccepted": "{{ cart.currency.iso_code }}",
  "priceRange": "{{ section.settings.price_range | escape }}"
}
</script>

{%- comment -%} AI-Optimized Meta Tags {%- endcomment -%}
{%- if product -%}
  <meta name="ai-product-type" content="{{ product.type | escape }}">
  <meta name="ai-product-vendor" content="{{ product.vendor | escape }}">
  <meta name="ai-product-price" content="{{ product.price | money_without_currency }}">
  <meta name="ai-product-currency" content="{{ cart.currency.iso_code }}">
  <meta name="ai-product-availability" content="{% if product.available %}in-stock{% else %}out-of-stock{% endif %}">
  
  {%- comment -%} AI-Friendly Product Features {%- endcomment -%}
  <meta name="ai-product-features" content="
    {%- for tag in product.tags -%}
      {%- unless tag contains 'spec:' -%}
        {{ tag }}{% unless forloop.last %}, {% endunless %}
      {%- endunless -%}
    {%- endfor -%}
  ">
  
  {%- comment -%} AI-Friendly Specifications {%- endcomment -%}
  <meta name="ai-product-specs" content="
    {%- for tag in product.tags -%}
      {%- if tag contains 'spec:' -%}
        {%- assign spec_parts = tag | split: ':' -%}
        {{ spec_parts[1] | replace: '_', ' ' }}: {{ spec_parts[2] }}{% unless forloop.last %}; {% endunless %}
      {%- endif -%}
    {%- endfor -%}
  ">
{%- endif -%}

{%- comment -%} AI-Friendly FAQ Schema {%- endcomment -%}
{%- if section.settings.show_faq -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What types of e-bikes do you sell?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "We specialize in electric bikes including commuter e-bikes, mountain e-bikes, cargo e-bikes, and folding e-bikes. All our bikes feature high-quality batteries, reliable motors, and premium components for the best riding experience."
        }
      },
      {
        "@type": "Question", 
        "name": "What is your shipping policy?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "We offer free shipping on orders over $100. Standard delivery takes 3-7 business days, while express delivery is available in 1-3 business days. International shipping is also available to most countries."
        }
      },
      {
        "@type": "Question",
        "name": "What is your return policy?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "We offer a 30-day return policy on all items. Items must be unused and in original packaging. We provide free returns for defective items, while customer returns may incur return shipping fees."
        }
      },
      {
        "@type": "Question",
        "name": "Do you offer warranties on e-bikes?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, all our e-bikes come with comprehensive warranties. Battery warranties typically last 2-3 years, while frame and component warranties vary by manufacturer. We also offer extended warranty options for additional peace of mind."
        }
      },
      {
        "@type": "Question",
        "name": "How do I maintain my e-bike battery?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "To maximize battery life: charge after each ride, store in a cool dry place, avoid extreme temperatures, and perform monthly full discharge cycles. Regular maintenance includes checking tire pressure, lubricating the chain every 100 miles, and annual professional servicing."
        }
      }
    ]
  }
  </script>
{%- endif -%}

{%- comment -%} AI-Friendly Breadcrumb Schema {%- endcomment -%}
{%- unless template == 'index' -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ shop.url }}"
      }
      {%- if collection -%},
      {
        "@type": "ListItem", 
        "position": 2,
        "name": "{{ collection.title | escape }}",
        "item": "{{ shop.url }}{{ collection.url }}"
      }
      {%- endif -%}
      {%- if product -%},
      {
        "@type": "ListItem",
        "position": {% if collection %}3{% else %}2{% endif %},
        "name": "{{ product.title | escape }}",
        "item": "{{ shop.url }}{{ product.url }}"
      }
      {%- endif -%}
    ]
  }
  </script>
{%- endunless -%}

{%- comment -%} AI-Optimized Invisible Content for Better Understanding {%- endcomment -%}
<div style="display: none;" aria-hidden="true" data-ai-context>
  {%- if product -%}
    <h1>{{ product.title }} - {{ product.type }} by {{ product.vendor }}</h1>
    <p>Price: {{ product.price | money }} ({{ product.price | money_without_currency }} {{ cart.currency.iso_code }})</p>
    <p>Availability: {% if product.available %}In Stock{% else %}Out of Stock{% endif %}</p>
    <p>Product Type: {{ product.type }}</p>
    <p>Brand: {{ product.vendor }}</p>
    <p>SKU: {{ product.selected_or_first_available_variant.sku }}</p>
    
    {%- if product.description != blank -%}
      <div>Product Description: {{ product.description | strip_html }}</div>
    {%- endif -%}
    
    <div>Key Features:
      {%- for tag in product.tags -%}
        {%- unless tag contains 'spec:' -%}
          {{ tag }}{% unless forloop.last %}, {% endunless %}
        {%- endunless -%}
      {%- endfor -%}
    </div>
    
    <div>Technical Specifications:
      {%- for tag in product.tags -%}
        {%- if tag contains 'spec:' -%}
          {%- assign spec_parts = tag | split: ':' -%}
          {{ spec_parts[1] | replace: '_', ' ' | capitalize }}: {{ spec_parts[2] }}.
        {%- endif -%}
      {%- endfor -%}
    </div>
    
    {%- if product.variants.size > 1 -%}
      <div>Available Options:
        {%- for variant in product.variants -%}
          {{ variant.title }} ({{ variant.price | money }}){% unless forloop.last %}, {% endunless %}
        {%- endfor -%}
      </div>
    {%- endif -%}
  {%- endif -%}
  
  <div>Store Information:
    Store Name: {{ shop.name }}
    Store Description: {{ shop.description | strip_html }}
    Store URL: {{ shop.url }}
    Currency: {{ cart.currency.iso_code }}
    Shipping: Free shipping on orders over $100
    Returns: 30-day return policy
    Payment Methods: Credit Cards, PayPal, Shop Pay, and more secure payment options
  </div>
</div>

{%- comment -%} AI Search Optimization Meta {%- endcomment -%}
<meta name="ai-store-type" content="E-commerce, Electric Bikes, E-bikes, Sustainable Transportation">
<meta name="ai-store-specialization" content="Electric bicycles, e-bike accessories, sustainable urban mobility">
<meta name="ai-customer-benefits" content="Free shipping, 30-day returns, expert support, quality guarantee, warranty coverage">
<meta name="ai-unique-selling-points" content="Premium e-bike selection, competitive pricing, expert customer service, comprehensive warranties">

{%- if collection -%}
  <meta name="ai-collection-type" content="{{ collection.title | escape }}">
  <meta name="ai-collection-description" content="{{ collection.description | strip_html | escape }}">
  <meta name="ai-collection-count" content="{{ collection.products_count }}">
{%- endif -%}

<style>
  /* AI-friendly hidden content styling */
  [data-ai-context] {
    position: absolute !important;
    left: -10000px !important;
    top: auto !important;
    width: 1px !important;
    height: 1px !important;
    overflow: hidden !important;
  }
</style>