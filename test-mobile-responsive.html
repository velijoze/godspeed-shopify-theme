<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Responsiveness Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 10px;
            background: #f3f4f6;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .viewport-controls {
            position: fixed;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10000;
        }
        .viewport-button {
            margin: 2px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .viewport-button.active {
            background: #3B82F6;
            color: white;
        }
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="viewport-controls">
        <div>Viewport Test:</div>
        <button class="viewport-button" onclick="setViewport(375, 667)">iPhone SE</button>
        <button class="viewport-button" onclick="setViewport(390, 844)">iPhone 12</button>
        <button class="viewport-button" onclick="setViewport(768, 1024)">iPad</button>
        <button class="viewport-button active" onclick="setViewport(1200, 800)">Desktop</button>
    </div>

    <div class="test-container">
        <h2>Mobile Responsiveness Test</h2>
        <div id="viewport-info">Current viewport: <span id="current-size"></span></div>
        <div id="test-results"></div>
    </div>

    <!-- Chat widget with mobile test settings -->
    <div class="pipeline-chat-widget" id="pipeline-chat-widget" 
         data-primary-provider="claude"
         data-fallback-enabled="true"
         data-hide-mobile="false">
        
        <button class="chat-trigger" data-chat-toggle aria-label="Open chat">
            <div class="chat-icon">ðŸ’¬</div>
            <span class="chat-text">Chat</span>
        </button>

        <div class="chat-panel" data-chat-panel>
            <div class="chat-header">
                <div class="chat-agent">
                    <div class="agent-info">
                        <div class="agent-name">E-Bike Expert</div>
                        <div class="agent-status">
                            <span class="status-dot online"></span>
                            <span class="status-text">Online</span>
                        </div>
                    </div>
                </div>
                <button class="chat-close" data-chat-close>âœ•</button>
            </div>

            <div class="chat-messages" data-chat-messages>
                <div class="message agent-message">
                    <div class="message-content">
                        <div class="message-text">Hi! I'm here to help you find the perfect e-bike.</div>
                        <div class="message-time">now</div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" 
                           class="chat-input" 
                           data-chat-input
                           placeholder="Your message..."
                           maxlength="500">
                    <button class="chat-send-button" data-chat-send aria-label="Send message">
                        âž¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/ai-chatbot-integration.js"></script>

    <script>
        class MobileResponsivenessTest {
            constructor() {
                this.results = document.getElementById('test-results');
                this.sizeDisplay = document.getElementById('current-size');
                this.updateSizeDisplay();
                this.runTests();
            }

            log(testName, passed, message) {
                const div = document.createElement('div');
                div.className = `test-result ${passed ? 'pass' : 'fail'}`;
                div.innerHTML = `<strong>${testName}:</strong> ${passed ? 'âœ“' : 'âœ—'} ${message}`;
                this.results.appendChild(div);
            }

            info(message) {
                const div = document.createElement('div');
                div.className = 'test-result info';
                div.innerHTML = `<strong>Info:</strong> ${message}`;
                this.results.appendChild(div);
            }

            updateSizeDisplay() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                this.sizeDisplay.textContent = `${width}x${height}`;
            }

            getDeviceCategory() {
                const width = window.innerWidth;
                if (width < 480) return 'mobile-small';
                if (width < 768) return 'mobile';
                if (width < 1024) return 'tablet';
                return 'desktop';
            }

            async runTests() {
                this.results.innerHTML = '';
                this.info(`Testing viewport: ${window.innerWidth}x${window.innerHeight} (${this.getDeviceCategory()})`);

                this.testChatWidgetVisibility();
                this.testChatTriggerSize();
                this.testChatPanelSize();
                this.testTextVisibility();
                this.testTouchTargets();
                await this.testInteraction();
            }

            testChatWidgetVisibility() {
                const chatWidget = document.getElementById('pipeline-chat-widget');
                const isVisible = chatWidget && window.getComputedStyle(chatWidget).display !== 'none';
                
                this.log(
                    'Chat Widget Visibility',
                    isVisible,
                    isVisible ? 'Chat widget is visible' : 'Chat widget is hidden'
                );
            }

            testChatTriggerSize() {
                const trigger = document.querySelector('[data-chat-toggle]');
                if (!trigger) return;

                const rect = trigger.getBoundingClientRect();
                const minTouchTarget = 44; // iOS/Android minimum touch target

                this.log(
                    'Touch Target Size',
                    rect.width >= minTouchTarget && rect.height >= minTouchTarget,
                    `Trigger size: ${Math.round(rect.width)}x${Math.round(rect.height)}px (min: ${minTouchTarget}px)`
                );
            }

            testChatPanelSize() {
                const panel = document.querySelector('[data-chat-panel]');
                if (!panel) return;

                // Temporarily show panel to measure
                const originalDisplay = panel.style.display;
                panel.style.display = 'flex';
                
                const rect = panel.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                panel.style.display = originalDisplay;

                const category = this.getDeviceCategory();
                
                if (category === 'mobile-small' || category === 'mobile') {
                    // On mobile, panel should take most of the screen
                    const widthRatio = rect.width / viewportWidth;
                    const heightRatio = rect.height / viewportHeight;
                    
                    this.log(
                        'Mobile Panel Size',
                        widthRatio > 0.8 && heightRatio > 0.6,
                        `Panel covers ${Math.round(widthRatio * 100)}% width, ${Math.round(heightRatio * 100)}% height`
                    );
                } else {
                    // On desktop/tablet, panel should be a reasonable size
                    this.log(
                        'Desktop Panel Size',
                        rect.width >= 300 && rect.width <= 400 && rect.height >= 400,
                        `Panel size: ${Math.round(rect.width)}x${Math.round(rect.height)}px`
                    );
                }
            }

            testTextVisibility() {
                const chatText = document.querySelector('.chat-text');
                if (!chatText) return;

                const isVisible = window.getComputedStyle(chatText).display !== 'none';
                const category = this.getDeviceCategory();

                if (category === 'mobile-small' || category === 'mobile') {
                    this.log(
                        'Mobile Text Hiding',
                        !isVisible,
                        isVisible ? 'Text should be hidden on mobile' : 'Text correctly hidden on mobile'
                    );
                } else {
                    this.log(
                        'Desktop Text Visibility',
                        isVisible,
                        isVisible ? 'Text visible on desktop' : 'Text hidden on desktop'
                    );
                }
            }

            testTouchTargets() {
                const touchElements = document.querySelectorAll('[data-chat-toggle], [data-chat-send], .quick-reply');
                let allTargetsGood = true;
                let minSize = Infinity;

                touchElements.forEach(element => {
                    const rect = element.getBoundingClientRect();
                    const size = Math.min(rect.width, rect.height);
                    minSize = Math.min(minSize, size);
                    if (size < 44) allTargetsGood = false;
                });

                this.log(
                    'All Touch Targets',
                    allTargetsGood,
                    `Smallest touch target: ${Math.round(minSize)}px (min: 44px)`
                );
            }

            async testInteraction() {
                const trigger = document.querySelector('[data-chat-toggle]');
                const panel = document.querySelector('[data-chat-panel]');
                
                if (!trigger || !panel) return;

                // Test opening
                trigger.click();
                
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const isOpen = panel.classList.contains('open') || panel.classList.contains('active');
                this.log(
                    'Panel Interaction',
                    isOpen,
                    isOpen ? 'Panel opens on trigger click' : 'Panel failed to open'
                );

                // Test input focus on mobile
                if (isOpen && (this.getDeviceCategory() === 'mobile' || this.getDeviceCategory() === 'mobile-small')) {
                    const input = document.querySelector('[data-chat-input]');
                    if (input) {
                        input.focus();
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                        this.log(
                            'Mobile Input Focus',
                            document.activeElement === input,
                            document.activeElement === input ? 'Input receives focus' : 'Input focus failed'
                        );
                    }
                }
            }
        }

        // Viewport switching function
        function setViewport(width, height) {
            // Remove active class from all buttons
            document.querySelectorAll('.viewport-button').forEach(btn => btn.classList.remove('active'));
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Set the viewport size (this is just for visual reference)
            document.body.style.width = width + 'px';
            document.body.style.height = height + 'px';
            document.body.style.overflow = 'hidden';
            document.body.style.border = '2px solid #3B82F6';
            
            // Update display and re-run tests
            setTimeout(() => {
                const test = new MobileResponsivenessTest();
            }, 100);
        }

        // Initialize tests
        window.addEventListener('load', () => {
            const test = new MobileResponsivenessTest();
        });

        // Re-test on resize
        window.addEventListener('resize', () => {
            setTimeout(() => {
                const test = new MobileResponsivenessTest();
            }, 100);
        });
    </script>

    <!-- Include the pipeline chat styles -->
    <style>
        .pipeline-chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .chat-trigger {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #3B82F6;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            font-size: 14px;
            min-height: 44px;
            min-width: 44px;
        }
        
        .chat-panel {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-panel.open {
            display: flex;
        }
        
        .chat-header {
            padding: 16px;
            background: #3B82F6;
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }
        
        .chat-input-container {
            padding: 16px;
            border-top: 1px solid #e5e7eb;
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 8px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 4px;
        }
        
        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 8px;
            outline: none;
        }
        
        .chat-send-button {
            background: #3B82F6;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            min-height: 44px;
            min-width: 44px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10B981;
            display: inline-block;
        }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .pipeline-chat-widget {
                bottom: 15px;
                right: 15px;
            }
            
            .chat-trigger {
                padding: 12px 16px;
            }
            
            .chat-text {
                display: none;
            }
            
            .chat-panel {
                width: calc(100vw - 30px);
                height: calc(100vh - 120px);
                bottom: 60px;
                right: -15px;
            }
        }
        
        @media (max-width: 480px) {
            .chat-panel {
                width: 100vw;
                height: 100vh;
                bottom: 0;
                right: -20px;
                border-radius: 0;
            }
        }
    </style>
</body>
</html>